package fsm;

import jade.core.behaviours.Behaviour;
import jade.lang.acl.ACLMessage;
import jade.lang.acl.MessageTemplate;
/*
 Espera la respuesta, si llega un acept, termina
 Si le llega un reject, lo que tiene que hacer calcualr mi zeuthen y enviarlo, y despues recibir el zeuthen del oponente
  
*/
public class EsperarRespuestaBehaviour extends Behaviour {
	
	private boolean flag;
	private int aux = -1;
	
	public EsperarRespuestaBehaviour() {
		this.flag = false;
	}
	@Override
	public void action() {
		MessageTemplate template = (MessageTemplate)getDataStore().get(MCPBehaviour.MESSAGE_TEMPLATE);
		
		ACLMessage respuesta = myAgent.receive(template);
		
		if (respuesta != null) {
			// PROCESO EL MENSAJE
			System.out.println("Mensaje recibido en Esperar Respuesta ");
			getDataStore().put(MCPBehaviour.ULTIMO_MSG, respuesta);
			this.flag = true;
			if(respuesta.getPerformative() == ACLMessage.ACCEPT_PROPOSAL) {
				aux = 1;
				//String peli = (String)getDataStore().get(MCPBehaviour.PROPUESTA);
				//System.out.println("Movie final   = " + peli);
			}

			if(respuesta.getPerformative() == ACLMessage.REJECT_PROPOSAL) {
				aux = 0;
			}
			
		}
		else
			block();
	}

	@Override
	public boolean done() {
		// TODO Auto-generated method stub
		return flag;
	}
	
	@Override
	public void reset() {
		super.reset();
		this.flag = false;
	}
	
	@Override
	public int onEnd() {
		return aux;
	}

}
